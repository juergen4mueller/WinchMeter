/*!
 * chartjs-plugin-zoom v2.0.1 â€“ kompatibel mit Chart.js 4.x
 */
(function(global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined'
        ? module.exports = factory(require('chart.js'))
        : (global.zoomPlugin = factory(global.Chart));
})(this, function(Chart) {
    'use strict';

    const zoomPlugin = {
        id: 'zoom',

        afterInit(chart) {
            chart.$zoom = { enabled: true };
        },

        beforeEvent(chart, args) {
            const event = args.event;

            if (!chart.$zoom.enabled) return;

            const opts = chart.options.plugins.zoom;
            if (!opts) return;

            const wheel = opts.zoom?.wheel?.enabled;
            const pan = opts.pan?.enabled;

            if (event.type === 'wheel' && wheel) {
                event.native.preventDefault();
                const delta = event.native.deltaY;
                const factor = delta > 0 ? 1.1 : 0.9;

                const xScale = chart.scales.x;
                const center = xScale.getValueForPixel(event.x);

                const min = xScale.min;
                const max = xScale.max;

                const newMin = center - (center - min) * factor;
                const newMax = center + (max - center) * factor;

                xScale.options.min = newMin;
                xScale.options.max = newMax;

                chart.update('none');
            }

            if (event.type === 'mousemove' && event.native.buttons === 1 && pan) {
                const xScale = chart.scales.x;
                const delta = -event.deltaX;

                const pixelPerUnit = (xScale.right - xScale.left) / (xScale.max - xScale.min);
                const shift = delta / pixelPerUnit;

                xScale.options.min += shift;
                xScale.options.max += shift;

                chart.update('none');
            }
        },

        resetZoom(chart) {
            const xScale = chart.scales.x;
            delete xScale.options.min;
            delete xScale.options.max;
            chart.update();
        }
    };

    return zoomPlugin;
});
